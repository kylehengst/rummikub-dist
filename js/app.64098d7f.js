(function(e){function t(t){for(var s,r,a=t[0],u=t[1],l=t[2],h=0,d=[];h<a.length;h++)r=a[h],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&d.push(o[r][0]),o[r]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(e[s]=u[s]);c&&c(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],s=!0,a=1;a<n.length;a++){var u=n[a];0!==o[u]&&(s=!1)}s&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var s={},o={app:0},i=[];function r(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=s,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var c=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),o=n.n(s);o.a},"049c":function(e,t,n){"use strict";var s=n("81e3"),o=n.n(s);o.a},2033:function(e,t,n){},"4cdd":function(e){e.exports=JSON.parse("[[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]]")},"4cf6":function(e,t,n){"use strict";var s=n("dbbf"),o=n.n(s);o.a},"518f":function(e,t,n){"use strict";var s=n("2033"),o=n.n(s);o.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{desktop:!e.touch},attrs:{id:"app"}},[e.connected?n("router-view"):n("div",[e._v("Error")])],1)},i=[],r=n("d4ec"),a=n("bee2"),u=n("262e"),l=n("2caf"),c=(n("c975"),n("a434"),function(){function e(){Object(r["a"])(this,e),this.onListeners={}}return Object(a["a"])(e,[{key:"on",value:function(e,t){this.onListeners[e]||(this.onListeners[e]=[]),this.onListeners[e].push(t)}},{key:"off",value:function(e,t){if(this.onListeners[e]){var n=this.onListeners[e].indexOf(t);n>-1&&this.onListeners[e].splice(n,1)}}},{key:"emit",value:function(e,t){if(this.onListeners[e])for(var n=1*this.onListeners[e].length,s=0;s<n;s++)this.onListeners[e]&&this.onListeners[e][s]&&this.onListeners[e][s](t)}},{key:"reset",value:function(){this.onListeners={}}}]),e}()),h=c,d="ws://localhost:5000",f=function(e){Object(u["a"])(n,e);var t=Object(l["a"])(n);function n(e){var s;return Object(r["a"])(this,n),s=t.call(this),s.id="",s.host=e,s.connect(),s}return Object(a["a"])(n,[{key:"connect",value:function(){var e=this;this.ws=new WebSocket(this.host),this.ws.onmessage=function(t){var n=JSON.parse(t.data);e.emit(n.event,n.data)},this.ws.onclose=function(){setTimeout((function(){e.connect(e.host)}),1e3)},this.ws.onerror=function(t){console.error(t),e.ws.close(),e.emit("close")}}},{key:"initGame",value:function(e){this.id=e,this.message({event:"game",id:e,data:{id:e}})}},{key:"startGame",value:function(e){this.id=e,this.message({event:"start_game",id:e,data:{id:e}})}},{key:"getGame",value:function(e){this.id=e,this.message({event:"get_game",id:e,data:{id:e}})}},{key:"initUser",value:function(e){this.message({event:"user",data:{id:e}})}},{key:"updateUser",value:function(e){this.message({event:"update_user",data:e})}},{key:"updateGameBoard",value:function(e){this.message({event:"update_game_board",data:e})}},{key:"resetGameBoard",value:function(){this.message({id:this.id,event:"reset_game_board",data:null})}},{key:"skipTurn",value:function(){this.message({event:"skip_turn",id:this.id,data:null})}},{key:"makeMove",value:function(e){this.message({event:"make_move",id:this.id,data:e})}},{key:"message",value:function(e){this.ws.send(JSON.stringify(e))}}]),n}(h),m=new f(d),g={data:function(){return{connected:!1,touch:!1,registered:!1}},beforeMount:function(){var e=this;console.log(m),this.touch="ontouchstart"in document.documentElement,this.touch&&this.$store.commit("setEventTypes",{down:"touchstart",move:"touchmove",up:"touchend"}),this.$store.commit("setTouch",this.touch),m.on("connected",(function(){e.connected=!0})),m.on("close",(function(){e.connected=!1}))}},p=g,v=(n("034f"),n("2877")),b=Object(v["a"])(p,o,i,!1,null,null,null),w=b.exports,y=n("8c4f"),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"home"}},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[e.registered?n("form",{on:{submit:function(t){return t.preventDefault(),e.startGame(t)}}},[n("div",{staticClass:"form-group"},[n("label",[e._v("Open/Create a game")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.game,expression:"game"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.game},on:{input:function(t){t.target.composing||(e.game=t.target.value)}}})]),n("button",{staticClass:"btn btn-primary"},[e._v("Go")])]):n("form",{on:{submit:function(t){return t.preventDefault(),e.updateUser(t)}}},[n("div",{staticClass:"form-group"},[n("label",[e._v("What is your name?")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}})]),n("button",{staticClass:"btn btn-primary"},[e._v("Submit")])])])])])},S=[],T=(n("b0c0"),{name:"Home",data:function(){return{game:"",registered:!1,user:""}},mounted:function(){m.on("game",this.onGame),m.on("user",this.onUser);var e=localStorage.getItem("user_id");m.initUser(e)},destroyed:function(){m.off("game",this.onGame)},methods:{startGame:function(){this.game&&m.initGame(this.game)},updateUser:function(){this.user&&(m.updateUser({name:this.user}),this.$store.commit("setUserName",this.user),this.registered=!0)},onUser:function(e){console.log("onUser",e),localStorage.setItem("user_id",e.id),e.name&&(this.registered=!0),this.$store.commit("setUserId",e.id),this.$store.commit("setUserName",e.name)},onGame:function(e){console.log(e),e.game.started?this.$router.push({name:"Game",params:{id:this.game}}):this.$router.push({name:"Lobby",params:{id:this.game}})}}}),k=T,$=(n("cf86"),Object(v["a"])(k,_,S,!1,null,"18835eb8",null)),G=$.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"lobby"}},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("p",[e._v("Waiting for players")]),n("ul",{staticClass:"list-group"},e._l(e.users,(function(t,s){return n("li",{key:s,staticClass:"list-group-item"},[e._v(" "+e._s(t.name)+" ")])})),0),n("div",{staticClass:"pb-3"}),e.users.length>1?n("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.start()}}},[e._v(" Play ")]):e._e()])])])},O=[],I={name:"Lobby",data:function(){return{started:!1,users:[]}},mounted:function(){this.$store.state.userId?(m.on("game",this.onGame),m.on("game_started",this.onGameStarted),m.on("new_user",this.onNewUser),m.getGame(this.$route.params.id)):this.$router.push({name:"Home"})},destroyed:function(){m.off("game",this.onGame),m.off("game_started",this.onGameStarted),m.off("new_user",this.onNewUser)},methods:{onGameStarted:function(){this.gotoGame()},onNewUser:function(e){this.users=e.users},onGame:function(e){console.log("onGameUsers",e),e.game&&e.users.length?e.game.started?this.gotoGame():this.users=e.users:this.$router.push({name:"Home"})},start:function(){m.startGame(this.$route.params.id)},gotoGame:function(){this.$router.push({name:"Game",params:{id:this.$route.params.id}})}}},N=I,U=(n("4cf6"),Object(v["a"])(N,x,O,!1,null,"355a71c1",null)),C=U.exports,L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{dragging:e.dragging},attrs:{id:"game"}},[n("div",{ref:"board",attrs:{id:"board"}},[n("div",{attrs:{id:"tiles"}},e._l(e.board,(function(t,s){return n("div",{key:s,staticClass:"tile-row"},e._l(t,(function(t,o){return n("div",{key:o,staticClass:"tile-slot",class:{"tile-slot-highlight":e.doHighlightTileSlot(s,o,!1)},attrs:{"data-row":s,"data-col":o}},[t?n("Tile",{attrs:{config:t,row:s,col:o,disabled:!e.yourTurn},on:{startdrag:e.onStartDrag,drag:e.onDragging,stopdrag:e.onStopDrag}}):e._e()],1)})),0)})),0)]),n("div",{ref:"shelf",attrs:{id:"user"}},e._l(e.shelf,(function(t,s){return n("div",{key:s,staticClass:"tile-row"},e._l(t,(function(t,o){return n("div",{key:o,staticClass:"tile-slot tile-slot-shelf",class:{"tile-slot-highlight":e.doHighlightTileSlot(s,o,!0)},attrs:{"data-row":s,"data-col":o}},[t?n("Tile",{attrs:{config:t,row:s,col:o,user:!0},on:{startdrag:e.onStartDrag,drag:e.onDragging,stopdrag:e.onStopDrag}}):e._e()],1)})),0)})),0),n("div",{attrs:{id:"users"}},e._l(e.users,(function(t,s){return n("div",{key:s,staticClass:"button",class:{active:e.currentUser==t.id}},[e._v(" "+e._s(t.name)+" ")])})),0),n("div",{attrs:{id:"actions"}},[e.yourTurn?n("div",{staticClass:"button",on:{click:function(t){return e.resetBoard()}}},[e._v("Reset")]):e._e(),e.yourTurn?n("div",{staticClass:"button",on:{click:function(t){return e.skipTurn()}}},[e._v("Skip")]):e._e(),e.yourTurn?n("div",{staticClass:"button",on:{click:function(t){return e.makeMove()}}},[e._v("Play")]):e._e()])])},M=[],E=(n("99af"),n("7db0"),n("c740"),n("4160"),n("159b"),n("4cdd")),j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"tile",staticClass:"tile",class:{dragging:e.dragging},style:e.style},[n("div",{class:e.config.color},[e.config.isJoker?n("span",[n("img",{attrs:{src:"/img/joker.png",alt:""}})]):n("span",[e._v(e._s(e.config.score))])])])},B=[],J={props:["config","row","col","user","disabled"],data:function(){return{touchIndex:0,dragging:!1,startX:0,startY:0,offsetX:0,offsetY:0,left:0,top:0,eventTypes:{down:"mousedown",move:"mousemove",up:"mouseup"}}},computed:{style:function(){return this.dragging?{left:this.left+this.offsetX+"px",top:this.top+this.offsetY+"px"}:{}}},beforeMount:function(){this.$store.state.touch&&(this.eventTypes.down="touchstart",this.eventTypes.move="touchmove",this.eventTypes.up="touchend")},destroyed:function(){this.$refs.tile&&this.$refs.tile.removeEventListener(this.eventTypes.down,this.onMouseDown)},mounted:function(){this.$refs.tile.addEventListener(this.eventTypes.down,this.onMouseDown)},methods:{getTouchIndex:function(e){var t=this,n=-1;if(this.$store.state.touch){if(!e.touches.length)return-2;e.touches.forEach((function(e,s){e.target==t.$refs.tile&&(n=s)}))}return n},onMouseDown:function(e){if(console.log(e),!this.disabled){this.touchIndex=this.getTouchIndex(e),this.offsetX=0,this.offsetY=0;var t=this.$store.state.touch?e.touches[this.touchIndex].clientX:e.x,n=this.$store.state.touch?e.touches[this.touchIndex].clientY:e.y;this.startX=t,this.startY=n;var s=e.target.getBoundingClientRect();this.left=s.left,this.top=s.top,window.addEventListener(this.eventTypes.up,this.onMouseUp),window.addEventListener(this.eventTypes.move,this.onMouseMove),this.$emit("startdrag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid}),this.dragging=!0,e.stopPropagation(),e.preventDefault()}},onMouseMove:function(e){if(this.touchIndex=this.getTouchIndex(e),!(this.$store.state.touch&&this.touchIndex<0)){var t=this.$store.state.touch?e.touches[this.touchIndex].clientX:e.x,n=this.$store.state.touch?e.touches[this.touchIndex].clientY:e.y;this.offsetX=t-this.startX,this.offsetY=n-this.startY,this.$emit("drag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid,x:t,y:n})}},onMouseUp:function(e){e.target==this.$refs.tile&&this.dragging&&(console.log("onMouseUp"),this.dragging=!1,window.removeEventListener(this.eventTypes.up,this.onMouseUp),window.removeEventListener(this.eventTypes.move,this.onMouseMove),this.$emit("stopdrag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid}))}}},D=J,H=(n("518f"),Object(v["a"])(D,j,B,!1,null,"6a465335",null)),P=H.exports;function R(){return E}var X={name:"Game",components:{Tile:P},data:function(){return{board:[],shelf:R(),user:null,grid:[],dragging:!1,boardRow:-1,boardCol:-1,shelfRow:-1,shelfCol:-1,boardHeight:0,tileSlot:[],users:[],gameId:"",currentUser:""}},beforeMount:function(){this.$store.state.userId?(console.log("beforeMount"),this.gameId=this.$route.params.id,m.on("game",this.onGame),m.on("game_board_updated",this.onGameBoard),m.on("reset_game_board",this.onGameBoardReset),m.on("new_tile",this.onNewTile),m.on("invalid_move",this.onInvalidMove),m.getGame(this.gameId)):this.$router.push({name:"Home"})},mounted:function(){window.addEventListener("resize",this.onResize),this.onResize()},destroyed:function(){window.removeEventListener("resize",this.onResize),m.off("game",this.onGame),m.off("game_board_updated",this.onGameBoard),m.off("reset_game_board",this.onGameBoardReset),m.off("new_tile",this.onNewTile),m.off("invalid_move",this.onNewTile)},computed:{yourTurn:function(){return this.currentUser==this.$store.state.userId}},methods:{onResize:function(){this.boardHeight=this.$refs.board.clientHeight},onGame:function(e){console.log(e),!e.game||e.users.length<2?this.$router.push({name:"Lobby",params:{id:this.gameId}}):(this.game=JSON.parse(JSON.stringify(e.game)),this.board=e.game.board,this.users=e.users,this.currentUser=e.game.currentUser,e.update||(this.setUserTiles(e.game.users),this.shelfSnapshot=JSON.parse(JSON.stringify(this.shelf))))},onGameBoard:function(e){console.log("onGameBoard",e),e.update&&this.board[e.update.row].splice(e.update.col,1,e.update.tile),e.remove&&this.board[e.remove.row].splice(e.remove.col,1,null)},onGameBoardReset:function(){console.log("onGameBoardReset"),this.resetBoard(!0)},onNewTile:function(e){console.log(e);var t=this.shelf[1].findIndex((function(e){return null===e}));this.shelf[1].splice(t,1,e.tile),this.shelfSnapshot=JSON.parse(JSON.stringify(this.shelf))},onInvalidMove:function(){alert("Invalid move")},setUserTiles:function(e){console.log("setUserTiles");var t=R(),n=JSON.parse(JSON.stringify(e[this.$store.state.userId].tiles));t[0].splice(0,n.length),t[0]=n.concat(t[0]),this.shelf=t},takeSnapshot:function(){this.snapshot=JSON.parse(JSON.stringify({game:this.game,shelf:this.shelf}))},resetShelf:function(){var e=this;this.board.forEach((function(t){t.forEach((function(t){t&&t.isOwn&&(t.shelf=!0,e.onNewTile({tile:t}))}))}))},resetBoard:function(){this.resetShelf(),m.resetGameBoard()},skipTurn:function(){this.currentUser="",this.resetShelf(),m.skipTurn()},makeMove:function(){var e=[];this.shelf.forEach((function(t){t.forEach((function(t){t&&e.push(t)}))})),m.makeMove({board:this.board,tiles:e})},onStartDrag:function(e,t){console.log(e,t)},onDragging:function(e,t){var n=this,s=t.x,o=t.y,i=s+this.$refs.board.scrollLeft,r=o+this.$refs.board.scrollTop,a=0,u=0,l=!1,c=!1,h=this.board;o>this.boardHeight&&(c=!0,h=this.shelf,i=s+this.$refs.shelf.scrollLeft,r=o+this.$refs.shelf.scrollTop,u=this.boardHeight),h.forEach((function(e,s){l||(a=0,e.forEach((function(e,o){if(!l)return i>=a&&i<=a+52&&r>=u&&r<=u+82?(n.$set(n.tileSlot,t.id,{row:s,col:o,shelf:c}),void(l=!0)):void(a+=52)})),u+=82)}))},onStopDrag:function(e,t){var n=this.tileSlot[t.id];console.log(e,n),n&&(n.shelf?this.updateShelf(e,t,n):this.updateBoard(e,t,n),this.$set(this.tileSlot,t.id,null))},updateBoard:function(e,t,n){var s;!this.board[n.row][n.col]&&this.yourTurn&&(this.board[n.row].splice(n.col,1,e),e.board?(this.board[t.row].splice(t.col,1,null),s={row:t.row,col:t.col}):(e.board=!0,this.shelf[t.row].splice(t.col,1,null)),m.updateGameBoard({id:this.gameId,update:{row:n.row,col:n.col,tile:e},remove:s}))},updateShelf:function(e,t,n){e.board&&!e.isOwn||this.shelf[n.row][n.col]||(console.log("updateShelf",e,n),this.shelf[n.row].splice(n.col,1,e),e.board?(this.board[t.row].splice(t.col,1,null),e.board=!1,m.updateGameBoard({id:this.gameId,remove:{row:t.row,col:t.col,tile:e},update:null})):this.shelf[t.row].splice(t.col,1,null))},getTouchIndex:function(e){var t=-1;return e.touches.forEach((function(n,s){n.target==e.target&&(t=s)})),t},doHighlightTileSlot:function(e,t,n){return!!this.tileSlot.find((function(s){if(s)return s.row==e&&s.col==t&&s.shelf==n}))}}},Y=X,z=(n("049c"),Object(v["a"])(Y,L,M,!1,null,"46ff2adc",null)),A=z.exports;s["a"].use(y["a"]);var W=[{path:"/",name:"Home",component:G},{path:"/lobby/:id",name:"Lobby",component:C},{path:"/game/:id",name:"Game",component:A}],F=new y["a"]({mode:"history",base:"/",routes:W}),q=F,K=n("2f62");s["a"].use(K["a"]);var Q=new K["a"].Store({state:{touch:!1,eventTypes:{down:"mousedown",move:"mousemove",up:"mouseup"},userName:"",userId:""},mutations:{setEventTypes:function(e,t){e.eventTypes=t},setTouch:function(e,t){e.touch=t},setUserName:function(e,t){e.userName=t},setUserId:function(e,t){e.userId=t}},actions:{},modules:{}}),V=n("9483");Object(V["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("c944");s["a"].config.productionTip=!1,new s["a"]({router:q,store:Q,render:function(e){return e(w)}}).$mount("#app")},"77fa":function(e,t,n){},"81e3":function(e,t,n){},"85ec":function(e,t,n){},c944:function(e,t,n){},cf86:function(e,t,n){"use strict";var s=n("77fa"),o=n.n(s);o.a},dbbf:function(e,t,n){}});
//# sourceMappingURL=app.64098d7f.js.map