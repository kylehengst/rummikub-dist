!function(e){function t(t){for(var o,a,r=t[0],l=t[1],u=t[2],d=0,m=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&m.push(n[a][0]),n[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(c&&c(t);m.length;)m.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],o=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=s[0]))}return e}var o={},n={app:0},i=[];function a(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=o,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(s,o,function(t){return e[t]}.bind(null,o));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var u=0;u<r.length;u++)t(r[u]);var c=l;i.push([0,"chunk-vendors"]),s()}({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var o=s("85ec");s.n(o).a},"0bbf":function(e,t,s){},2033:function(e,t,s){},"2f2b":function(e,t,s){},"493b":function(e,t,s){"use strict";var o=s("2f2b");s.n(o).a},"4cdd":function(e){e.exports=JSON.parse("[[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]]")},"518f":function(e,t,s){"use strict";var o=s("2033");s.n(o).a},"56d7":function(e,t,s){"use strict";s.r(t),s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),n=s("d4ec"),i=s("bee2"),a=s("262e"),r=s("2caf"),l=(s("c975"),s("a434"),function(){function e(){Object(n.a)(this,e),this.onListeners={}}return Object(i.a)(e,[{key:"on",value:function(e,t){this.onListeners[e]||(this.onListeners[e]=[]),this.onListeners[e].push(t)}},{key:"off",value:function(e,t){if(this.onListeners[e]){var s=this.onListeners[e].indexOf(t);s>-1&&this.onListeners[e].splice(s,1)}}},{key:"emit",value:function(e,t){if(this.onListeners[e])for(var s=1*this.onListeners[e].length,o=0;o<s;o++)this.onListeners[e]&&this.onListeners[e][o]&&this.onListeners[e][o](t)}},{key:"reset",value:function(){this.onListeners={}}}]),e}()),u=new(function(e){Object(a.a)(s,e);var t=Object(r.a)(s);function s(e){var o;return Object(n.a)(this,s),(o=t.call(this)).id="",o.host=e,o.api="https://rummikub-server.kylehengst.com",o.connect(),o}return Object(i.a)(s,[{key:"connect",value:function(){var e=this;this.ws=new WebSocket(this.host),this.ws.onmessage=function(t){var s=JSON.parse(t.data);e.emit(s.event,s.data)},this.ws.onopen=function(t){console.log("onopen",t);var s=localStorage.getItem("token");e.initUser(s),e.emit("open")},this.ws.onclose=function(t){console.log("onclose",t),setTimeout((function(){e.connect(e.host)}),1e3)},this.ws.onerror=function(t){console.error(t),e.ws.close(),e.emit("close")}}},{key:"initGame",value:function(e){this.id=e,this.message({event:"game",id:e,data:{id:e}})}},{key:"createGame",value:function(){this.message({event:"create_game"})}},{key:"startGame",value:function(e){this.id=e,this.message({event:"start_game",id:e,data:{id:e}})}},{key:"getGame",value:function(e){this.id=e,this.message({event:"get_game",id:e,data:{id:e}})}},{key:"getGameDetails",value:function(e){this.id=e,this.message({event:"game_details",id:e,data:{id:e}})}},{key:"initUser",value:function(e){this.message({event:"user",data:{id:e}})}},{key:"updateUser",value:function(e){this.message({event:"update_user",data:e})}},{key:"updateGameBoard",value:function(e){this.message({event:"update_game_board",data:e})}},{key:"resetGameBoard",value:function(){this.message({id:this.id,event:"reset_game_board",data:null})}},{key:"skipTurn",value:function(e){this.message({event:"skip_turn",id:this.id,data:e})}},{key:"makeMove",value:function(e){this.message({event:"make_move",id:this.id,data:e})}},{key:"message",value:function(e){this.ws.send(JSON.stringify(e))}}]),s}(l))("wss://rummikub-server.kylehengst.com"),c={data:function(){return{connected:!1,touch:!1,registered:!1}},beforeMount:function(){var e=this;console.log(u),this.touch="ontouchstart"in document.documentElement,this.touch&&this.$store.commit("setEventTypes",{down:"touchstart",move:"touchmove",up:"touchend"}),this.$store.commit("setTouch",this.touch),u.on("open",(function(){e.connected=!0})),u.on("close",(function(){console.log("close"),e.connected=!1}))},methods:{}},d=(s("034f"),s("2877")),m=Object(d.a)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{desktop:!e.touch},attrs:{id:"app"}},[e.connected?s("router-view"):s("div",{staticClass:"connecting py-5"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body"},[e._v(" Connecting... ")])])]),s("div",{attrs:{id:"modals"}},[s("div",{staticClass:"modal fade",class:{show:e.$store.state.modal,"d-block":e.$store.state.modal},attrs:{id:"exampleModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[e.$store.state.modalTitle?s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[e._v(" "+e._s(e.$store.state.modalTitle)+" ")]),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"},on:{click:function(t){return e.$store.commit("closeModal")}}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])])]):e._e(),e.$store.state.modalBody?s("div",{staticClass:"modal-body"},[e._v(" "+e._s(e.$store.state.modalBody)+" ")]):e._e(),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(t){return e.$store.commit("closeModal")}}},[e._v(" Close ")])])])])]),e.$store.state.modal?s("div",{staticClass:"modal-backdrop fade show",on:{click:function(t){return e.$store.commit("closeModal")}}}):e._e()]),s("audio",{attrs:{src:"/sound/cardPlace.mp3",id:"cardPlace"}}),s("audio",{attrs:{src:"/sound/bell.mp3",id:"bell"}}),s("audio",{attrs:{src:"/sound/alert.mp3",id:"alert"}})],1)}),[],!1,null,null,null).exports,h=s("8c4f"),f=(s("99af"),s("b0c0"),s("d3b7"),s("96cf"),s("1da1")),g=(s("4160"),s("159b"),{props:["config","row","col","user","disabled"],data:function(){return{touchIndex:0,dragging:!1,startX:0,startY:0,offsetX:0,offsetY:0,left:0,top:0,eventTypes:{down:"mousedown",move:"mousemove",up:"mouseup"}}},computed:{style:function(){return this.dragging?{left:this.left+this.offsetX+"px",top:this.top+this.offsetY+"px"}:{}}},beforeMount:function(){this.$store.state.touch&&(this.eventTypes.down="touchstart",this.eventTypes.move="touchmove",this.eventTypes.up="touchend")},destroyed:function(){this.$refs.tile&&this.$refs.tile.removeEventListener(this.eventTypes.down,this.onMouseDown)},mounted:function(){this.$refs.tile.addEventListener(this.eventTypes.down,this.onMouseDown)},methods:{getTouchIndex:function(e){var t=this,s=-1;if(this.$store.state.touch){if(!e.touches.length)return-2;e.touches.forEach((function(e,o){e.target==t.$refs.tile&&(s=o)}))}return s},onMouseDown:function(e){if(console.log(e),!this.disabled){this.touchIndex=this.getTouchIndex(e),this.offsetX=0,this.offsetY=0;var t=this.$store.state.touch?e.touches[this.touchIndex].clientX:e.x,s=this.$store.state.touch?e.touches[this.touchIndex].clientY:e.y;this.startX=t,this.startY=s;var o=e.target.getBoundingClientRect();this.left=o.left,this.top=o.top,window.addEventListener(this.eventTypes.up,this.onMouseUp),window.addEventListener(this.eventTypes.move,this.onMouseMove),this.$emit("startdrag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid}),this.dragging=!0,e.stopPropagation(),e.preventDefault()}},onMouseMove:function(e){if(this.touchIndex=this.getTouchIndex(e),!(this.$store.state.touch&&this.touchIndex<0)){var t=this.$store.state.touch?e.touches[this.touchIndex].clientX:e.x,s=this.$store.state.touch?e.touches[this.touchIndex].clientY:e.y;this.offsetX=t-this.startX,this.offsetY=s-this.startY,this.$emit("drag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid,x:t,y:s})}},onMouseUp:function(e){e.target==this.$refs.tile&&this.dragging&&(console.log("onMouseUp"),this.dragging=!1,window.removeEventListener(this.eventTypes.up,this.onMouseUp),window.removeEventListener(this.eventTypes.move,this.onMouseMove),this.$emit("stopdrag",this.config,{row:this.row,col:this.col,touchIndex:this.touchIndex,id:this._uid}))}}}),p=(s("518f"),Object(d.a)(g,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"tile",staticClass:"tile",class:{dragging:e.dragging},style:e.style},[s("div",{class:e.config.color},[e.config.isJoker?s("span",[s("img",{attrs:{src:"/img/joker.png",alt:""}})]):s("span",[e._v(e._s(e.config.score))])])])}),[],!1,null,"6a465335",null)).exports,v={name:"Home",components:{Tile:p},data:function(){return{sharedGameName:"",sharedGame:null,game:"",registered:!1,user:"",prompt:!1,shareGame:"",username:"",password:"",newUser:{username:"",password:"",gamer_tag:"",email:""}}},created:function(){var e=this;this.$workbox&&this.$workbox.addEventListener("waiting",(function(){e.prompt=!0}))},mounted:function(){u.on("game",this.onGame),u.on("user",this.onUser),u.on("game_details",this.onGameDetails);var e=localStorage.getItem("token");u.initUser(e),this.sharedGameName=this.$route.query.share||"",this.sharedGameName&&u.getGameDetails(this.sharedGameName)},destroyed:function(){u.off("game",this.onGame),u.off("user",this.onUser),u.off("game_details",this.onGameDetails)},computed:{yourGames:function(){return this.$store.state.savedGames.concat().sort((function(e,t){var s=e.date_created||0,o=t.date_created||0;return o>s?1:o<s?-1:0}))}},methods:{upgrade:function(){var e=this;return Object(f.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.prompt=!1,t.next=3,e.$workbox.messageSW({type:"SKIP_WAITING"});case 3:case"end":return t.stop()}}),t)})))()},startNewGame:function(){u.createGame(this.game)},joinGame:function(e){u.initGame(e.name)},startGame:function(e){this.game=e.name,u.initGame(this.game)},updateUser:function(){this.user&&(u.updateUser({name:this.user}),this.$store.commit("setUserName",this.user),this.registered=!0)},signup:function(){var e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newUser)};console.log(e);var t=200;window.fetch(u.api+"/signup",e).then((function(e){return console.log(e),t=e.status,e.json()})).then((function(e){if(console.log(e),t>=300)throw e;localStorage.setItem("token",e.token),u.initUser(e.token)})).catch((function(e){console.log(e.message),alert(e.message)}))},login:function(){var e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})};console.log(e);var t=200;window.fetch(u.api+"/login",e).then((function(e){return t=e.status,e.json()})).then((function(e){if(console.log(e),t>=300)throw e;localStorage.setItem("token",e.token),u.initUser(e.token)})).catch((function(e){console.log(e.message),alert(e.message)}))},onUser:function(e){console.log("onUser",e),this.registered=!0,this.$store.commit("setUserId",e.user.id),this.$store.commit("setUserUuid",e.user.uuid),this.$store.commit("setUserName",e.user.username),this.$store.commit("setGames",e.games)},onGame:function(e){console.log("onGame",e),e.game.started?this.$router.push({name:"Game",params:{id:e.game.name}}):this.$router.push({name:"Lobby",params:{id:e.game.name}})},onGameDetails:function(e){console.log("onGameDetails",e),this.sharedGame=e.game}}},b=(s("ff23"),Object(d.a)(v,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container py-5",attrs:{id:"home"}},[s("div",{staticClass:"mb-5 d-flex justify-content-md-center"},[s("div",{staticClass:"d-flex"},[s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"R"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"u"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"m"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"m"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"i"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"k"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"u"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"red",score:"b"},row:0,col:0}}),s("Tile",{attrs:{disabled:!0,config:{color:"black",score:"i",isJoker:!0},row:0,col:0}})],1)]),s("div",{staticClass:"row justify-content-md-center"},[s("div",{staticClass:"col-sm-6"},[e.prompt?s("div",{staticClass:"mb-5"},[s("button",{staticClass:"btn btn-lg btn-block btn-info",on:{click:e.upgrade}},[e._v(" Click here to update ")])]):e._e(),e.registered?s("div",[s("div",{staticClass:"mb-5"},[s("button",{staticClass:"btn btn-lg btn-block btn-success",on:{click:function(t){return e.startNewGame()}}},[e._v(" Create a new game ")])]),e.sharedGame?s("div",{staticClass:"mb-5"},[s("h3",{staticClass:"mb-3"},[e._v("Invitation")]),s("div",{staticClass:"list-group"},[s("a",{staticClass:"list-group-item list-group-item-action bg-success",attrs:{href:"#"},on:{click:function(t){return e.joinGame(e.sharedGame)}}},[s("div",{staticClass:"d-flex w-100 justify-content-between"},[s("h4",{staticClass:"text-dark mb-3"},[s("strong",e._l(e.sharedGame.users,(function(t,o){return s("span",{key:o},[o?s("span",{staticClass:"px-2"},[e._v("vs")]):e._e(),s("span",[e._v(e._s(t.gamer_tag))]),t.id==e.sharedGame.current_user?s("span",[e._v("ðŸ‘ˆ")]):e._e()])})),0)])]),s("div",{staticClass:"d-flex"},[e._m(0),s("div",{staticClass:"flex-fill"}),e.sharedGame.complete?s("div",{staticClass:"text-white mb-0"},[s("strong",[e._v(" "+e._s(e.sharedGame.winning_gamer_tag)+" wins! ")])]):e._e()])])])]):e._e(),e.yourGames.length?s("div",[s("h3",{staticClass:"mb-3"},[e._v("Your Games")]),s("div",{staticClass:"list-group"},e._l(e.yourGames,(function(t,o){return s("a",{key:o,staticClass:"list-group-item list-group-item-action bg-success",attrs:{href:"#"},on:{click:function(s){return e.startGame(t)}}},[s("div",{staticClass:"d-flex w-100 justify-content-between"},[s("h4",{staticClass:"text-dark mb-3"},[s("strong",e._l(t.users,(function(o,n){return s("span",{key:n},[n?s("span",{staticClass:"px-2"},[e._v("vs")]):e._e(),o.id!=t.current_user||t.complete?e._e():s("span",[e._v("ðŸ‘‰")]),o.id==t.winning_user&&t.complete?s("span",[e._v("ðŸ¥³")]):e._e(),o.id!=t.winning_user&&t.complete?s("span",[e._v("ðŸ˜¢")]):e._e(),s("span",[e._v(e._s(o.gamer_tag))])])})),0)])]),s("div",{staticClass:"d-flex"},[s("div",[t.complete?s("strong",[e._v("Game has ended")]):t.started?s("strong",[e._v("Game has started")]):s("strong",[e._v("Waiting for players")])]),s("div",{staticClass:"flex-fill"}),t.complete?s("div",{staticClass:"text-white mb-0"},[s("strong",[e._v(" "+e._s(t.winning_gamer_tag)+" wins! ")])]):e._e()])])})),0)]):e._e()]):s("div",[s("h3",{staticClass:"mb-3"},[e._v("Login")]),s("form",{staticClass:"mb-5",on:{submit:function(t){return t.preventDefault(),e.login(t)}}},[s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Username")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-control input-lg",attrs:{type:"text",autocapitalize:"none"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Password")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control input-lg",attrs:{type:"text"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),s("button",{staticClass:"btn btn-success btn-lg"},[e._v("Submit")])]),s("h3",{staticClass:"mb-3"},[e._v("Sign Up")]),s("form",{staticClass:"mb-5",on:{submit:function(t){return t.preventDefault(),e.signup(t)}}},[s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Username")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newUser.username,expression:"newUser.username"}],staticClass:"form-control input-lg",attrs:{type:"text",autocapitalize:"none",required:""},domProps:{value:e.newUser.username},on:{input:function(t){t.target.composing||e.$set(e.newUser,"username",t.target.value)}}})]),s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Password")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newUser.password,expression:"newUser.password"}],staticClass:"form-control input-lg",attrs:{type:"text",required:""},domProps:{value:e.newUser.password},on:{input:function(t){t.target.composing||e.$set(e.newUser,"password",t.target.value)}}})]),s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Gamer Name")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newUser.gamer_tag,expression:"newUser.gamer_tag"}],staticClass:"form-control input-lg",attrs:{type:"text",required:""},domProps:{value:e.newUser.gamer_tag},on:{input:function(t){t.target.composing||e.$set(e.newUser,"gamer_tag",t.target.value)}}})]),s("div",{staticClass:"input-group-lg mb-3"},[s("label",[e._v("Email")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newUser.email,expression:"newUser.email"}],staticClass:"form-control input-lg",attrs:{type:"email"},domProps:{value:e.newUser.email},on:{input:function(t){t.target.composing||e.$set(e.newUser,"email",t.target.value)}}})]),s("button",{staticClass:"btn btn-success btn-lg"},[e._v("Submit")])])]),s("hr"),s("div",[e._v("Version 0.10")])])])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("strong",[e._v("Click to join")])])}],!1,null,"040a1f85",null)).exports,w={name:"Lobby",data:function(){return{gameId:"",started:!1,users:[],game:null}},mounted:function(){this.$store.state.userId?(this.gameId=this.$route.params.id,u.on("game",this.onGame),u.on("game_details",this.onGameDetails),u.on("game_started",this.onGameStarted),u.on("new_user",this.onNewUser),u.getGame(this.$route.params.id)):this.$router.push({name:"Home"})},destroyed:function(){u.off("game",this.onGame),u.off("game_started",this.onGameStarted),u.off("new_user",this.onNewUser)},methods:{onGameStarted:function(){this.gotoGame()},onNewUser:function(e){this.users=e.users},onGame:function(e){console.log("onGameUsers",e),e.game&&e.users.length?e.game.started?this.gotoGame():(this.game=e.game,this.users=e.users):this.$router.push({name:"Home"})},onGameDetails:function(e){this.game=e.game},start:function(){u.startGame(this.$route.params.id)},gotoGame:function(){this.$router.push({name:"Game",params:{id:this.$route.params.id}})},shareGame:function(){location.href="mailto:?subject=Lets play Rummikub&body=".concat(location.origin,"/?share=").concat(this.gameId)}}},_=(s("9e66"),Object(d.a)(w,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container py-5",attrs:{id:"lobby"}},[e.game?s("div",[s("h3",{staticClass:"mb-3"},[e._v("Waiting for players")]),s("ul",{staticClass:"list-group"},[s("li",{staticClass:"list-group-item bg-success"},[s("h4",{staticClass:"text-dark mb-0"},[s("strong",e._l(e.users,(function(t,o){return s("span",{key:o},[o?s("span",{staticClass:"px-2"},[e._v("vs")]):e._e(),s("span",[e._v(e._s(t.gamer_tag))])])})),0)])])]),s("div",{staticClass:"pb-3"}),s("div",{staticClass:"d-flex"},[s("button",{staticClass:"btn  btn-lg",class:{"btn-info":e.users.length<2,"btn-dark":e.users.length>1},on:{click:function(t){return e.shareGame()}}},[e._v(" Share game ")]),s("div",{staticClass:"flex-fill"}),e.users.length>1?s("button",{staticClass:"btn btn-info btn-lg",on:{click:function(t){return e.start()}}},[e._v(" Play ")]):e._e()])]):e._e(),s("hr"),s("div",{staticClass:"text-right"},[s("button",{staticClass:"btn btn-dark",on:{click:function(t){return e.$router.push({name:"Home"})}}},[e._v(" Return to Home ")])])])}),[],!1,null,"70dd91be",null)).exports;s("7db0"),s("c740");var y={playSound:function(e){var t=new Audio;(t=document.getElementById(e)).currentTime=0,t.play()}},C=s("4cdd");var k={name:"Game",components:{Tile:p},data:function(){return{board:[],shelf:C,user:null,grid:[],dragging:!1,boardRow:-1,boardCol:-1,shelfRow:-1,shelfCol:-1,boardHeight:0,tileSlot:[],users:[],gameId:"",currentUser:"",modal:!1,modalBody:""}},beforeMount:function(){this.$store.state.userId?(console.log("beforeMount"),this.gameId=this.$route.params.id,u.on("game",this.onGame),u.on("reset",this.onReset),u.on("game_board_updated",this.onGameBoard),u.on("reset_game_board",this.onGameBoardReset),u.on("new_tile",this.onNewTile),u.on("invalid_move",this.onInvalidMove),u.on("winner",this.onWinner),u.getGame(this.gameId)):this.$router.push({name:"Home"})},mounted:function(){window.addEventListener("resize",this.onResize),this.onResize()},destroyed:function(){window.removeEventListener("resize",this.onResize),u.off("game",this.onGame),u.off("reset",this.onReset),u.off("game_board_updated",this.onGameBoard),u.off("reset_game_board",this.onGameBoardReset),u.off("new_tile",this.onNewTile),u.off("invalid_move",this.onInvalidMove),u.off("winner",this.onWinner)},computed:{yourTurn:function(){if(!this.game||!this.game.complete)return this.currentUser==this.$store.state.userId}},methods:{onReset:function(){this.$router.push({name:"Home"})},onResize:function(){this.boardHeight=this.$refs.board.clientHeight},onGame:function(e){console.log(e),!e.game||e.users.length<2?this.$router.push({name:"Lobby",params:{id:this.gameId}}):(this.game=JSON.parse(JSON.stringify(e.game)),this.board=e.game.board,this.users=e.users,this.currentUser=e.game.complete?"":e.game.current_user,e.update?this.currentUser==this.$store.state.userId&&y.playSound("bell"):(this.setUserTiles(e.game.users),this.shelfSnapshot=JSON.parse(JSON.stringify(this.shelf))))},onGameBoard:function(e){console.log("onGameBoard",e),e.update&&this.board[e.update.row].splice(e.update.col,1,e.update.tile),e.remove&&this.board[e.remove.row].splice(e.remove.col,1,null),y.playSound("cardPlace")},onGameBoardReset:function(){console.log("onGameBoardReset"),this.resetBoard(!0)},onNewTile:function(e){console.log(e);var t=this.shelf[1].findIndex((function(e){return null===e}));this.shelf[1].splice(t,1,e.tile),this.shelfSnapshot=JSON.parse(JSON.stringify(this.shelf))},onInvalidMove:function(){this.$store.commit("setModal",{title:"Invalid move"}),y.playSound("alert")},onWinner:function(e){this.$store.commit("setModal",{title:"".concat(e.winner.name," wins!")})},setUserTiles:function(e){console.log("setUserTiles"),this.shelf=e[this.$store.state.userUuid].shelf},takeSnapshot:function(){this.snapshot=JSON.parse(JSON.stringify({game:this.game,shelf:this.shelf}))},resetShelf:function(){var e=this;this.board.forEach((function(t){t.forEach((function(t){t&&t.isOwn&&(t.board=!1,e.onNewTile({tile:t}))}))}))},resetBoard:function(){this.resetShelf(),u.resetGameBoard()},skipTurn:function(){this.currentUser="",u.skipTurn({shelf:this.shelf}),this.resetShelf()},makeMove:function(){var e=[];this.shelf.forEach((function(t){t.forEach((function(t){t&&e.push(t)}))})),u.makeMove({board:this.board,tiles:e,shelf:this.shelf})},onStartDrag:function(e,t){console.log(e,t)},onDragging:function(e,t){var s=this,o=t.x,n=t.y,i=o+this.$refs.board.scrollLeft,a=n+this.$refs.board.scrollTop,r=0,l=0,u=!1,c=!1,d=this.board;n>this.boardHeight&&(c=!0,d=this.shelf,i=o+this.$refs.shelf.scrollLeft,a=n+this.$refs.shelf.scrollTop,l=this.boardHeight),d.forEach((function(e,o){u||(r=0,e.forEach((function(e,n){if(!u)return i>=r&&i<=r+52&&a>=l&&a<=l+82?(s.$set(s.tileSlot,t.id,{row:o,col:n,shelf:c}),void(u=!0)):void(r+=52)})),l+=82)}))},onStopDrag:function(e,t){var s=this.tileSlot[t.id];console.log(e,s),s&&(s.shelf?this.updateShelf(e,t,s):this.updateBoard(e,t,s),this.$set(this.tileSlot,t.id,null),y.playSound("cardPlace"))},updateBoard:function(e,t,s){var o;!this.board[s.row][s.col]&&this.yourTurn&&(this.board[s.row].splice(s.col,1,e),e.board?(this.board[t.row].splice(t.col,1,null),o={row:t.row,col:t.col}):(e.board=!0,this.shelf[t.row].splice(t.col,1,null)),u.updateGameBoard({id:this.gameId,update:{row:s.row,col:s.col,tile:e},remove:o}))},updateShelf:function(e,t,s){e.board&&!e.isOwn||this.shelf[s.row][s.col]||(console.log("updateShelf",e,s),this.shelf[s.row].splice(s.col,1,e),e.board?(this.board[t.row].splice(t.col,1,null),e.board=!1,u.updateGameBoard({id:this.gameId,remove:{row:t.row,col:t.col,tile:e},update:null})):this.shelf[t.row].splice(t.col,1,null))},getTouchIndex:function(e){var t=-1;return e.touches.forEach((function(s,o){s.target==e.target&&(t=o)})),t},doHighlightTileSlot:function(e,t,s){return!!this.tileSlot.find((function(o){if(o)return o.row==e&&o.col==t&&o.shelf==s}))}}},G=(s("493b"),Object(d.a)(k,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{dragging:e.dragging},attrs:{id:"game"}},[s("div",{ref:"board",attrs:{id:"board"}},[s("div",{attrs:{id:"tiles"}},e._l(e.board,(function(t,o){return s("div",{key:o,staticClass:"tile-row"},e._l(t,(function(t,n){return s("div",{key:n,staticClass:"tile-slot",class:{"tile-slot-highlight":e.doHighlightTileSlot(o,n,!1)},attrs:{"data-row":o,"data-col":n}},[t?s("Tile",{attrs:{config:t,row:o,col:n,disabled:!e.yourTurn},on:{startdrag:e.onStartDrag,drag:e.onDragging,stopdrag:e.onStopDrag}}):e._e()],1)})),0)})),0)]),s("div",{ref:"shelf",attrs:{id:"user"}},e._l(e.shelf,(function(t,o){return s("div",{key:o,staticClass:"tile-row"},e._l(t,(function(t,n){return s("div",{key:n,staticClass:"tile-slot tile-slot-shelf",class:{"tile-slot-highlight":e.doHighlightTileSlot(o,n,!0)},attrs:{"data-row":o,"data-col":n}},[t?s("Tile",{attrs:{config:t,row:o,col:n,user:!0},on:{startdrag:e.onStartDrag,drag:e.onDragging,stopdrag:e.onStopDrag}}):e._e()],1)})),0)})),0),s("div",{attrs:{id:"users"}},e._l(e.users,(function(t,o){return s("div",{key:o,staticClass:"button mr-2",class:{active:e.currentUser==t.id}},[e.currentUser==t.id?s("span",[e._v("ðŸ‘‰")]):e._e(),s("span",[e._v(e._s(t.gamer_tag))])])})),0),s("div",{attrs:{id:"actions"}},[s("div",{staticClass:"button",on:{click:function(t){return e.$router.push({name:"Home"})}}},[e._v("Home")]),e.yourTurn?s("div",{staticClass:"button ml-5",on:{click:function(t){return e.resetBoard()}}},[e._v("Restore")]):e._e(),e.yourTurn?s("div",{staticClass:"button ml-3",on:{click:function(t){return e.skipTurn()}}},[e._v("Pass")]):e._e(),e.yourTurn?s("div",{staticClass:"button ml-5",on:{click:function(t){return e.makeMove()}}},[e._v("Play")]):e._e()])])}),[],!1,null,"03532247",null)).exports;o.default.use(h.a);var x=[{path:"/index.html",component:b},{path:"/",name:"Home",component:b},{path:"/lobby/:id",name:"Lobby",component:_},{path:"/game/:id",name:"Game",component:G}],$=new h.a({mode:"history",base:"/",routes:x}),T=s("2f62");o.default.use(T.a);var S,U=new T.a.Store({state:{touch:!1,eventTypes:{down:"mousedown",move:"mousemove",up:"mouseup"},userName:"",userId:"",userUuid:"",modal:!1,modalTitle:"",modalBody:"",savedGames:[]},mutations:{setEventTypes:function(e,t){e.eventTypes=t},setTouch:function(e,t){e.touch=t},setUserName:function(e,t){e.userName=t},setUserId:function(e,t){e.userId=t},setUserUuid:function(e,t){e.userUuid=t},setModal:function(e,t){e.modalTitle=t.title||"",e.modalBody=t.body||"",e.modal=!0},closeModal:function(e){e.modal=!1},setGames:function(e,t){e.savedGames=t}},actions:{},modules:{}}),I=s("acfa");"serviceWorker"in navigator?((S=new I.a("".concat("/","service-worker.js"))).addEventListener("controlling",(function(e){console.log("controlling",e),window.location.reload()})),S.addEventListener("message",(function(e){console.log("message",e)})),S.register()):S=null;var O=S,N=(s("7588"),s("c944"),s("2b88")),M=s.n(N);o.default.use(M.a),o.default.config.productionTip=!1,o.default.prototype.$workbox=O,new o.default({router:$,store:U,render:function(e){return e(m)}}).$mount("#app")},7588:function(e,t,s){},"85ec":function(e,t,s){},"9e66":function(e,t,s){"use strict";var o=s("0bbf");s.n(o).a},c5a2:function(e,t,s){},c944:function(e,t,s){},ff23:function(e,t,s){"use strict";var o=s("c5a2");s.n(o).a}});